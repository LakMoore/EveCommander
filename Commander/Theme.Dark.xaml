<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

  <!-- Color palette -->
  <Color x:Key="BackgroundColor">#FF1E1E1E</Color>
  <Color x:Key="SurfaceColor">#FF252526</Color>
  <Color x:Key="AccentColor">#FF007ACC</Color>
  <Color x:Key="ForegroundColor">#FFF0F0F0</Color>
  <Color x:Key="SecondaryForegroundColor">#FFBFBFBF</Color>
  <Color x:Key="BorderColor">#FF3C3C3C</Color>
  <Color x:Key="HoverColor">#FF2E2E2E</Color>
  <SolidColorBrush x:Key="HoverBrush" Color="{StaticResource HoverColor}" />
  <!-- Selection for list / row highlight in dark mode -->
  <Color x:Key="SelectionColor">#FF264F66</Color>
  <SolidColorBrush x:Key="SelectionBrush" Color="{StaticResource SelectionColor}" />

  <!-- Brushes -->
  <SolidColorBrush x:Key="BackgroundBrush" Color="{StaticResource BackgroundColor}" />
  <SolidColorBrush x:Key="SurfaceBrush" Color="{StaticResource SurfaceColor}" />
  <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}" />
  <SolidColorBrush x:Key="ForegroundBrush" Color="{StaticResource ForegroundColor}" />
  <SolidColorBrush x:Key="SecondaryForegroundBrush" Color="{StaticResource SecondaryForegroundColor}" />
  <SolidColorBrush x:Key="BorderBrush" Color="{StaticResource BorderColor}" />

  <!-- Window default -->
  <Style TargetType="Window">
    <Setter Property="Background" Value="{StaticResource BackgroundBrush}" />
    <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
  </Style>

  <!-- TextBlock defaults -->
  <Style TargetType="TextBlock">
    <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
  </Style>

  <!-- Button style -->
  <Style TargetType="Button">
    <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
    <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
    <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
    <Setter Property="BorderThickness" Value="1" />
    <Setter Property="Padding" Value="8,4" />
    <Setter Property="Margin" Value="4" />
    <Setter Property="SnapsToDevicePixels" Value="True" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="Button">
          <Border x:Name="Bd"
                  Background="{TemplateBinding Background}"
                  BorderBrush="{TemplateBinding BorderBrush}"
                  BorderThickness="{TemplateBinding BorderThickness}"
                  CornerRadius="3"
                  Padding="{TemplateBinding Padding}">
            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" RecognizesAccessKey="True"/>
          </Border>
          <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
              <Setter TargetName="Bd" Property="Background" Value="{StaticResource HoverBrush}" />
            </Trigger>
            <Trigger Property="IsPressed" Value="True">
              <Setter TargetName="Bd" Property="Background" Value="{StaticResource SurfaceBrush}" />
              <Setter Property="Opacity" Value="0.9" />
            </Trigger>
            <Trigger Property="IsEnabled" Value="False">
              <Setter Property="Foreground" Value="{StaticResource SecondaryForegroundBrush}" />
              <Setter TargetName="Bd" Property="Opacity" Value="0.6" />
            </Trigger>
          </ControlTemplate.Triggers>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>

  <!-- (implicit Button style defined above) -->

  <!-- TextBox style -->
  <Style TargetType="TextBox">
    <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
    <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
    <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
    <Setter Property="BorderThickness" Value="1" />
  </Style>

  <!-- ToggleButton (used by ComboBox chevron) - ensure hover uses dark theme hover brush -->
  <Style TargetType="ToggleButton">
    <Setter Property="Background" Value="Transparent" />
    <Setter Property="BorderBrush" Value="Transparent" />
    <Setter Property="BorderThickness" Value="0" />
    <Setter Property="Padding" Value="0" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="ToggleButton">
          <Border x:Name="Bd"
                  Background="{TemplateBinding Background}"
                  BorderBrush="{TemplateBinding BorderBrush}"
                  BorderThickness="{TemplateBinding BorderThickness}"
                  CornerRadius="2">
            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
          </Border>
          <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
              <Setter TargetName="Bd" Property="Background" Value="{StaticResource HoverBrush}" />
            </Trigger>
            <Trigger Property="IsPressed" Value="True">
              <Setter TargetName="Bd" Property="Background" Value="{StaticResource SurfaceBrush}" />
            </Trigger>
            <Trigger Property="IsEnabled" Value="False">
              <Setter TargetName="Bd" Property="Opacity" Value="0.6" />
            </Trigger>
          </ControlTemplate.Triggers>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>

  <!-- ListBox/ListView -->
  <Style TargetType="ListBox">
    <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
    <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
    <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
    <Setter Property="BorderThickness" Value="1" />
  </Style>
  <Style TargetType="ListView" BasedOn="{StaticResource {x:Type ListBox}}" />

  <!-- Menu / MenuItem -->
  <Style TargetType="Menu">
    <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
    <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
  </Style>
  <Style TargetType="MenuItem">
    <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
    <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
  </Style>

  <!-- ComboBox and items -->
  <Style TargetType="ComboBox">
    <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
    <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
    <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
    <Setter Property="BorderThickness" Value="1" />
    <Setter Property="Padding" Value="4,2" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="ComboBox">
          <Grid>
            <!-- Header area: make the whole header a ToggleButton so clicks on body open dropdown -->
            <ToggleButton x:Name="ToggleButton"
                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                          Background="{TemplateBinding Background}"
                          BorderBrush="{TemplateBinding BorderBrush}"
                          BorderThickness="{TemplateBinding BorderThickness}"
                          Padding="{TemplateBinding Padding}"
                          HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                          MinHeight="24"
                          Width="{Binding ActualWidth, RelativeSource={RelativeSource TemplatedParent}}"
                          HorizontalContentAlignment="Stretch"
                          VerticalContentAlignment="Center"
                          Focusable="False">
              <Grid HorizontalAlignment="Stretch" Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ToggleButton}}">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <!-- Content in column 0 (auto width), spacer in column 1, chevron in column 2 -->
                <ContentControl Grid.Column="0"
                                Margin="8,0,6,0"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Left"
                                Content="{TemplateBinding SelectionBoxItem}"
                                IsHitTestVisible="False">
                  <ContentControl.ContentTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding}" TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" />
                    </DataTemplate>
                  </ContentControl.ContentTemplate>
                </ContentControl>
                <!-- spacer column (Grid.Column=1) left intentionally empty to push chevron right -->
                <Path Grid.Column="2" Data="M 0 0 L 4 4 L 8 0 Z" Fill="{StaticResource ForegroundBrush}" HorizontalAlignment="Center" VerticalAlignment="Center" Width="10" Height="6" Margin="6,0,8,0"/>
              </Grid>
            </ToggleButton>
            <Popup Name="PART_Popup"
                   Placement="Bottom"
                   IsOpen="{TemplateBinding IsDropDownOpen}"
                   PlacementTarget="{Binding RelativeSource={RelativeSource TemplatedParent}}"
                   AllowsTransparency="True"
                   Focusable="False"
                   PopupAnimation="Fade"
                   StaysOpen="False"
                   MinWidth="{Binding ActualWidth, RelativeSource={RelativeSource TemplatedParent}}">
              <Border Background="{StaticResource SurfaceBrush}"
                      BorderBrush="{StaticResource BorderBrush}"
                      BorderThickness="1"
                      Padding="2"
                      MinWidth="{Binding ActualWidth, RelativeSource={RelativeSource TemplatedParent}}">
                <ScrollViewer CanContentScroll="True"
                              MinWidth="{Binding ActualWidth, RelativeSource={RelativeSource TemplatedParent}}"
                              MaxHeight="300">
                  <ItemsPresenter />
                </ScrollViewer>
              </Border>
            </Popup>
          </Grid>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
  <Style TargetType="ComboBoxItem">
    <Setter Property="Background" Value="Transparent" />
    <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
    <Setter Property="Padding" Value="4,2" />
    <Style.Triggers>
      <Trigger Property="IsMouseOver" Value="True">
        <Setter Property="Background" Value="{StaticResource HoverBrush}" />
      </Trigger>
      <Trigger Property="IsSelected" Value="True">
        <Setter Property="Background" Value="{StaticResource AccentBrush}" />
        <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
      </Trigger>
    </Style.Triggers>
  </Style>
  <!-- (implicit ComboBoxItem style defined above) -->

  <!-- CheckBox style for dark mode -->
  <Style TargetType="CheckBox">
    <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
    <Setter Property="Background" Value="Transparent" />
    <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
    <Setter Property="Padding" Value="2" />
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="CheckBox">
          <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
            <Border x:Name="Box"
                    Width="16" Height="16"
                    Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="2"
                    VerticalAlignment="Center" />
            <Path x:Name="CheckMark"
                  Data="M2,8 L6,12 L14,4"
                  Stroke="{TemplateBinding Foreground}"
                  StrokeThickness="2"
                  StrokeLineJoin="Round"
                  StrokeStartLineCap="Round"
                  StrokeEndLineCap="Round"
                  Visibility="Collapsed"
                  VerticalAlignment="Center"
                  Margin="-16,0,0,0" />
            <ContentPresenter Margin="6,0,0,0" VerticalAlignment="Center"/>
          </StackPanel>
          <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
              <Setter TargetName="Box" Property="Background" Value="{StaticResource HoverBrush}" />
            </Trigger>
            <Trigger Property="IsPressed" Value="True">
              <Setter TargetName="Box" Property="Background" Value="{StaticResource SurfaceBrush}" />
            </Trigger>
            <Trigger Property="IsChecked" Value="True">
              <Setter TargetName="Box" Property="Background" Value="{StaticResource AccentBrush}" />
              <Setter TargetName="CheckMark" Property="Visibility" Value="Visible" />
            </Trigger>
            <Trigger Property="IsEnabled" Value="False">
              <Setter Property="Opacity" Value="0.6" />
            </Trigger>
          </ControlTemplate.Triggers>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
</ResourceDictionary>
